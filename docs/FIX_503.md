# Fix 503 Service Unavailable Error

## Diagnostic du Probl√®me

L'erreur **503 Service Unavailable** signifie que le dyno Heroku ne r√©pond pas. Causes possibles:

1. **Dyno endormi** (Basic dyno dort apr√®s 30 min d'inactivit√©)
2. **Dyno crash√©**
3. **Application non d√©marr√©e correctement**

## Solution Imm√©diate

### √âtape 1: V√©rifier le statut du dyno

```powershell
heroku ps --app leadflow-backend-eu
```

**R√©sultats possibles:**
- `up` = Dyno fonctionne ‚úÖ
- `idle` = Dyno endormi üò¥
- `crashed` = Dyno crash√© ‚ùå
- `starting` = Dyno en cours de d√©marrage ‚è≥

### √âtape 2: Red√©marrer le dyno

```powershell
heroku restart --app leadflow-backend-eu
```

### √âtape 3: V√©rifier les logs

```powershell
heroku logs --tail --app leadflow-backend-eu
```

Cherchez des erreurs comme:
- `Application error`
- `H10` (App crashed)
- `H12` (Request timeout)
- `R10` (Boot timeout)

### √âtape 4: Tester apr√®s red√©marrage

Attendez 10-15 secondes, puis testez:

```powershell
# Test health endpoint
Invoke-RestMethod -Uri "https://leadflow-backend-eu-8d20fb5efc7b.herokuapp.com/health/"
```

## Solution Permanente: Upgrader le Dyno

Le Basic dyno ($5/mois) dort apr√®s 30 minutes d'inactivit√©. Pour √©viter cela:

### Upgrade vers Standard-1X (Recommand√©)

```powershell
# Upgrade vers Standard-1X (ne dort jamais)
heroku ps:resize web=standard-1x --app leadflow-backend-eu

# Red√©marrer apr√®s upgrade
heroku restart --app leadflow-backend-eu
```

**Co√ªt:** $25/mois (vs $5/mois pour Basic)
**Avantages:**
- ‚úÖ Ne dort jamais
- ‚úÖ Meilleures performances
- ‚úÖ Plus fiable pour la production

## Commandes de Diagnostic Compl√®tes

```powershell
# 1. V√©rifier le statut
heroku ps --app leadflow-backend-eu

# 2. Voir les logs r√©cents
heroku logs --tail -n 100 --app leadflow-backend-eu

# 3. V√©rifier les config vars
heroku config --app leadflow-backend-eu

# 4. V√©rifier les addons (base de donn√©es)
heroku addons --app leadflow-backend-eu

# 5. Red√©marrer
heroku restart --app leadflow-backend-eu

# 6. Tester l'endpoint
Invoke-RestMethod -Uri "https://leadflow-backend-eu-8d20fb5efc7b.herokuapp.com/health/"
```

## V√©rification Post-Red√©marrage

Apr√®s avoir red√©marr√©, v√©rifiez dans votre navigateur:

1. **Ouvrez DevTools** ‚Üí Network tab
2. **Rafra√Æchissez la page**
3. **V√©rifiez la requ√™te** `contacts/?limit=500`
4. **Statut devrait √™tre:** `200 OK` (pas 503)

Si c'est toujours 503:
- V√©rifiez les logs pour des erreurs
- V√©rifiez que la base de donn√©es est attach√©e
- V√©rifiez que les migrations sont √† jour

## Erreurs Communes et Solutions

### H10 - App Crashed
```powershell
# V√©rifier les logs pour l'erreur
heroku logs --tail --app leadflow-backend-eu

# V√©rifier les requirements.txt
# V√©rifier les config vars (SECRET_KEY, DATABASE_URL, etc.)
```

### R10 - Boot Timeout
```powershell
# L'application prend trop de temps √† d√©marrer
# V√©rifier les migrations, collectstatic, etc.
heroku run bash -c "cd backend && python manage.py migrate" --app leadflow-backend-eu
```

### H12 - Request Timeout
```powershell
# Requ√™te prend trop de temps
# V√©rifier les requ√™tes √† la base de donn√©es
# Optimiser les requ√™tes lentes
```

## Checklist de V√©rification

- [ ] Dyno est `up` (pas `idle` ou `crashed`)
- [ ] Logs ne montrent pas d'erreurs critiques
- [ ] DATABASE_URL est configur√©
- [ ] SECRET_KEY est configur√©
- [ ] Migrations sont √† jour
- [ ] Health endpoint r√©pond avec `200 OK`
- [ ] Frontend peut faire des requ√™tes API

